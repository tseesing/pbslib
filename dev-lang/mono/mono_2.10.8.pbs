#
# StartOS package build script
#
# Copyright 2012 StartOS
# Distributed under the terms of the GNU General Public License v2
#

DESCRIPTION="Free implementation of the .NET platform including runtime and compiler"
HOMEPAGE="http://www.mono-project.com"
LICENSE="GPL,LGPL2,MPL,MITX11"
PACKAGER="Zhongxin Huang <huangzhongxin@ivali.com>"

SRC_URI="http://download.mono-project.com/sources/"$N"/"$N-$V".tar.bz2"
CHECKSUM="c012b01ac17bedb0af52b7a16405da84"

RDEPEND="glibc gcc-libs zlib"
BDEPEND="pkgconfig"
RECOMMENDED=""
CONFLICT=""

OPTIONS="nostrip"

pbs_unpack() {
    dounpack
}

pbs_build() {
    # Build mono
    config+="--with-libgdiplus=installed"
    doconfig
    domake
    # Build jay
    cd mcs/jay
    domake
}

pbs_install() {
    cd "$SRCDIR"
    # Install mono
    domkinstall
    dodoc mcs/MIT.X11
    # Install jay
    cd mcs/jay
    domkinstall prefix=/usr install=../../install-sh
    # Install binfmt conf file and pathes
    docp "$FILESDIR"/mono.conf "$PKGDIR"/usr/lib/binfmt.d/
    # Fix .pc file to be able to request mono on what it depends, fixes #go-oo build
    sed -i -e "s:#Requires:Requires:" "$PKGDIR"/usr/lib"$LIBDIRSUFFIX"/pkgconfig/mono.pc
}
