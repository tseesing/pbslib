#
# StartOS package build script
#
# Copyright 2012 StartOS
# Distributed under the terms of the GNU General Public License v2
#

DESCRIPTION="A in-process library that implements SQL database engine"
HOMEPAGE="http://www.sqlite.org"
LICENSE="custom"
PACKAGER="Zhongxin Huang <huangzhongxin@ivali.com>"

# tarball containing the amalgamation for SQLite >= 3.7.5 together with a configure script and makefile for building it; includes now also the Tcl Extension Architecture (TEA)
SRC_URI="http://www.sqlite.org/sqlite-autoconf-3071401.tar.gz"
CHECKSUM="4cf3fd434bbb6e50777019ff3507bfa5"

RDEPEND="readline ncurses glibc"
BDEPEND="tcl"

pbs_unpack() {
    dounpack
}

pbs_build() {
    export CFLAGS="$CFLAGS -DSQLITE_ENABLE_FTS3=1 -DSQLITE_ENABLE_COLUMN_METADATA=1 -DSQLITE_ENABLE_UNLOCK_NOTIFY -DSQLITE_SECURE_DELETE"
    # Build sqlite
    #./configure --prefix=/usr --disable-static || return 1
    config+="--disable-static" 
    doconfig || die "sqlite configure failed."
    domake   || die "sqlite make failed."
    # Build the tcl extension    
    cd tea
    config+=" --with-system-sqlite" 
    doconfig || die "tcl extension configure failed."
    domake  || die "tcl extension make failed."
}

pbs_install() {
    # Install the tcl extension
    cd "$SRCDIR"/tea
    domkinstall || die "tcl extension make install failed."
    # Install sqlite
    cd "$SRCDIR"
    domkinstall
    dodoc "$FILESDIR"/license.txt
}
