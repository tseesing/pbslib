#
# StartOS package build script
#
# Copyright 2012 StartOS
# Distributed under the terms of the GNU General Public License v2
#

DESCRIPTION="The Tcl scripting language"
HOMEPAGE="http://tcl.sourceforge.net/"
LICENSE="custom"
PACKAGER="Zhongxin Huang <huangzhongxin@ivali.com>"
 
SRC_URI="http://downloads.sourceforge.net/"$N"/"$N$V"-src.tar.gz"
CHECKSUM="573aa5fe678e9185ef2b3c56b24658d3"

RDEPEND="glibc zlib"
BDEPEND=""

pbs_unpack() {
    dounpack
}

pbs_patch() {
    # We build the tcl sqlite interface in sqlite-tcl package
    rm -rf pkgs/sqlite3*
}   

pbs_config() {
    cd unix
    config+="--enable-threads"
    [ x"$ARCH" = x"x86_64" ] && config+="--enable-64bit" || config+="--disable-64bit"
    doconfig
}

pbs_build() {
    domake
}

pbs_install() {
    make INSTALL_ROOT="$PKGDIR" install install-private-headers
    dodoc ../license.terms
    cd "$PKGDIR"
    doln /usr/bin/tclsh${V%.?} usr/bin/tclsh
    # Remove buildroot traces
    sed -i "s#$SRCDIR#/usr/src/$N$V#" usr/lib"$LIBDIRSUFFIX"/{tcl,tdbc1.0.0/tdbc,itcl4.0.0/itcl}Config.sh
}
