#
# StartOS package build script
#
# Copyright 2012 StartOS
# Distributed under the terms of the GNU General Public License v2
#

DESCRIPTION="A collection of tools and libraries for many image formats"
HOMEPAGE="http://www.imagemagick.org/"
LICENSE="custom"
PACKAGER="Zhongxinhuang <huangzhongxin@ivali.com>"

SRC_URI="ftp://ftp.sunet.se/pub/multimedia/graphics/ImageMagick/ImageMagick-"${V%.*}"-"${V##*.}".tar.xz"

RDEPEND="liblqr libtool pango libwmf ghostscript librsvg openexr"
RECOMMENDED=""
OPTIONAL="ghostscript: for Ghostscript support
          openexr: for OpenEXR support
          libwmf: for WMF support
          librsvg: for SVG support
          libxml2: for XML support
          jasper: for JPEG-2000 support
          libpng: for PNG support"

pbs_unpack() {
    dounpack
}

pbs_patch() {
    sed '/AC_PATH_XTRA/d' -i configure.ac
    autoreconf --force --install
    dopatch perlmagick.rpath.patch
}

pbs_config() {
    config+="--with-modules 
             --disable-static 
             --disable-openmp 
             --with-wmf 
             --with-openexr 
             --with-xml
             --with-lcms2
             --with-jp2 
             --with-gslib 
             --with-perl
             --with-lqr 
             --with-rsvg 
             --without-gvc 
             --without-djvu 
             --without-autotrace 
             --without-webp 
             --without-jbig 
             --without-fpx 
             --without-dps 
             --without-fftw"
    doconfig --with-perl-options=\"INSTALLDIRS=vendor\"
}

pbs_build() {
    domake
}

pbs_install() {
    domkinstall
    dodoc LICENSE
    rm -fr "$PKGDIR"/usr/share/doc/ImageMagick/
    perl_cleanup
}
